<!DOCTYPE html>
<html lang="zh-cn" class="h-full">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=7200&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>告别手动上传！踩坑一下午，终于搞定了 Hugo &#43; GitHub Actions 全自动部署 | Windows DIY 博客</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        
                        'geek-purple': {
                            400: '#a855f7', 
                            500: '#8b5cf6',
                        },
                        
                        'geek-bg': '#0d0d0d', 
                    },
                    
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                color: theme('colors.gray.300'),
                                a: {
                                    color: theme('colors.geek-purple.400'),
                                    '&:hover': {
                                        color: theme('colors.white'),
                                    },
                                },
                                h1: { color: theme('colors.white') },
                                h2: { color: theme('colors.white') },
                                h3: { color: theme('colors.white') },
                                strong: { color: theme('colors.white') },
                                code: { color: theme('colors.geek-purple.400') },
                                blockquote: { 
                                    borderLeftColor: theme('colors.geek-purple.500'),
                                    color: theme('colors.gray.400')
                                },
                            },
                        },
                    }),
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/custom.css">
    
</head>
<body class="bg-geek-bg text-gray-200 font-mono h-full overflow-hidden">

    <div class="h-full flex flex-col">
        <nav class="p-6 border-b border-gray-800 flex justify-between items-center flex-shrink-0 bg-geek-bg/95 backdrop-blur z-10">
            <a href="/" class="text-xl font-bold text-geek-purple-400 hover:text-white transition duration-300">
                Windows DIY 博客
            </a>
            <div class="space-x-4 text-sm">
                <a href="/posts" class="hover:text-geek-purple-400 transition">Blog</a>
                <a href="/about" class="hover:text-geek-purple-400 transition">About</a>
            </div>
        </nav>

        <div class="flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar">
            <main class="container mx-auto px-4 py-8 max-w-4xl">
                
<article class="prose prose-invert lg:prose-xl mx-auto">
    <header class="mb-10">
        <h1 class="text-4xl font-bold text-white mb-4">告别手动上传！踩坑一下午，终于搞定了 Hugo &#43; GitHub Actions 全自动部署</h1>
        <div class="text-gray-500 text-sm flex items-center gap-4">
            <span>📅 2026-01-14</span>
            <span>⏱️ 2 min read</span>
            
                <span class="px-2 py-1 bg-purple-900 text-purple-200 rounded text-xs">
                    技术折腾
                </span>
            
        </div>
    </header>

    
    <div class="mb-10 rounded-lg overflow-hidden border border-gray-800">
        <img src="https://bing.biturl.top/?resolution=1920&amp;format=image&amp;index=0&amp;mkt=zh-CN" alt="cover" class="w-full h-auto object-cover">
    </div>
    

    <div class="leading-relaxed text-gray-300">
        <h1 id="告别手动上传踩坑一下午终于搞定了-hugo--github-actions-全自动部署">告别手动上传！踩坑一下午，终于搞定了 Hugo + GitHub Actions 全自动部署</h1>
<h2 id="前言为什么我要折腾这个">前言：为什么我要折腾这个？</h2>
<p>作为一个追求效率（其实是懒）的技术爱好者，我实在受够了每次写完博客都要手动生成、连接服务器、拖拽上传文件的繁琐流程。</p>
<p>理想中的博客发布流程应该是这样的：</p>
<ol>
<li>在本地 VS Code 里写好文章。</li>
<li>敲一行 <code>git push</code>。</li>
<li><strong>喝口水，网站自动更新。</strong></li>
</ol>
<p>为了实现这个，我决定搭建一套 <strong>Hugo + GitHub Actions + 腾讯云</strong> 的自动化流水线。本以为半小时搞定，结果因为 SSH 密钥和 Linux 权限问题，硬是踩了几个小时的坑。</p>
<p>为了防止下次重装服务器时失忆，特此记录全流程，尤其是那些让我头秃的报错。</p>
<hr>
<h2 id="-架构速览">🛠️ 架构速览</h2>
<ul>
<li><strong>本地环境</strong>：Windows + VS Code (配置了透明背景与极客工作区)</li>
<li><strong>静态生成器</strong>：Hugo</li>
<li><strong>代码仓库</strong>：GitHub (私有仓库)</li>
<li><strong>服务器</strong>：腾讯云轻量应用服务器 (Debian/Ubuntu)</li>
<li><strong>Web 服务</strong>：Nginx</li>
<li><strong>自动化工具</strong>：GitHub Actions</li>
</ul>
<hr>
<h2 id="-踩坑实录那些阻挡我自动化的大boss">🚧 踩坑实录：那些阻挡我自动化的“大Boss”</h2>
<h3 id="-关卡一git-push-时的拒绝访问">🛑 关卡一：Git Push 时的“拒绝访问”</h3>
<p>刚初始化完仓库，准备推送到 GitHub 时，终端直接甩给我一个 <code>failed to push some refs</code>。</p>
<p><strong>原因分析</strong>：
这是新手经典问题。我在 GitHub 建仓库时手滑勾选了“创建 README”，导致远程仓库里有一个本地没有的文件。Git 觉得这俩历史线对不上，拒绝合并。</p>
<p><strong>💡 解决方案</strong>：
简单粗暴，直接强制把本地作为唯一真理：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 关联远程仓库</span>
</span></span><span style="display:flex;"><span>git remote add origin <span style="color:#f92672">[</span>https://github.com/你的用户名/你的仓库.git<span style="color:#f92672">](</span>https://github.com/你的用户名/你的仓库.git<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 强行覆盖远程（仅限第一次初始化时使用！）</span>
</span></span><span style="display:flex;"><span>git push -u origin main -f
</span></span></code></pre></div><hr>
<h3 id="-关卡二ssh-密钥的密码陷阱">🛑 关卡二：SSH 密钥的“密码陷阱”</h3>
<p>GitHub Actions 需要一把“钥匙”才能进入我的服务器。我兴冲冲地在本地生成了密钥填进去，结果 Actions 日志直接报错：
<code>ssh: handshake failed: ssh: unable to authenticate</code></p>
<p><strong>原因分析</strong>：
我看日志发现提示 <code>private key is passphrase protected</code>。原来是我生成密钥时习惯性地输入了保护密码。<strong>自动化脚本是没有手的，它没法在运行的时候输入密码</strong>，所以直接握手失败。</p>
<p><strong>💡 解决方案</strong>：
生成一个专门给机器用的“无密码”密钥：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># -N &#34;&#34; 表示密码为空，-m PEM 是为了保证格式兼容性</span>
</span></span><span style="display:flex;"><span>ssh-keygen -t rsa -b <span style="color:#ae81ff">4096</span> -m PEM <span style="color:#f92672">-f</span> ~/.ssh/github_deploy -N <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><hr>
<h3 id="-关卡三linux-权限的洁癖-最坑的一步">🛑 关卡三：Linux 权限的“洁癖” (最坑的一步！)</h3>
<p>这是卡我最久的地方。明明密钥填对了，公钥也放进服务器的 <code>authorized_keys</code> 了，本地测试连接却依然提示：
<code>Permission denied (publickey)</code></p>
<p><strong>原因分析</strong>：
Linux 的 SSH 服务有极其严格的权限检查机制（简称“洁癖”）。
如果你的 <code>.ssh</code> 目录或者 <code>authorized_keys</code> 文件权限太开放（比如谁都能读写），SSH 会觉得这把锁不安全，直接禁用它，而且<strong>不会告诉你原因</strong>。</p>
<p><strong>💡 解决方案</strong>：
必须严格执行权限修正“三部曲”：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 1. 目录只能自己进 (700)</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">700</span> ~/.ssh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 钥匙文件只能自己读 (600)</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">600</span> ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. (容易漏) 确保用户家目录没有被设为 777</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">750</span> /root
</span></span></code></pre></div><hr>
<h3 id="-关卡四服务器配置的隐形门">🛑 关卡四：服务器配置的“隐形门”</h3>
<p>搞定权限后，本地能连上了，但 GitHub Actions 还是报错。最后查出来是服务器 SSH 配置的问题。</p>
<p><strong>原因分析</strong>：
云服务器出于安全考虑，默认是在 <code>/etc/ssh/sshd_config</code> 里禁止 <code>root</code> 用户远程登录的，甚至可能没开启公钥验证功能。</p>
<p><strong>💡 解决方案</strong>：
修改 <code>/etc/ssh/sshd_config</code>，找到并修改以下核心配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>PubkeyAuthentication yes      # 开启公钥验证
</span></span><span style="display:flex;"><span>PermitRootLogin yes           # 允许 Root 登录 (安全起见建议后续改用普通用户)
</span></span></code></pre></div><p>改完记得重启服务：<code>systemctl restart ssh</code>。</p>
<hr>
<h2 id="-最终成果丝滑的自动化体验">✨ 最终成果：丝滑的自动化体验</h2>
<p>在解决了上述所有问题后，我看着 GitHub Actions 的界面从红色的 ❌ 变成了绿色的 ✅。</p>
<p>现在，我的工作流变成了：</p>
<ol>
<li><strong>写作</strong>：在 VS Code 沉浸式透明背景下，用 Markdown 敲下文字。</li>
<li><strong>提交</strong>：<code>git commit -m &quot;new post&quot;</code> &amp; <code>git push</code>。</li>
<li><strong>完成</strong>：GitHub 自动编译 Hugo，自动通过 SCP 将静态文件传输到腾讯云 Nginx 目录。</li>
</ol>
<h3 id="-附我的-vs-code-极客配置">🎨 附：我的 VS Code 极客配置</h3>
<p>为了让写博客更有仪式感，我还专门配置了 VS Code 的 <code>.code-workspace</code>：</p>
<ul>
<li><strong>GlassIt-VSC 插件</strong>：一键调整窗口透明度，让代码悬浮在壁纸上。</li>
<li><strong>状态栏变色</strong>：设置 <code>statusBar.background</code> 为深紫色，进入专注模式。</li>
<li><strong>连体字体</strong>：使用 <code>JetBrains Mono</code>，让 <code>=&gt;</code> 等符号变得无比优雅。</li>
</ul>
<hr>
<h2 id="-总结">📝 总结</h2>
<p>这次折腾让我明白，<strong>CI/CD（持续集成部署）</strong> 并没有想象中那么遥不可及。虽然中间涉及到了 Git 冲突、SSH 协议细节、Linux 权限管理等底层知识，但当跑通那一刻，那种“掌控感”是无与伦比的。</p>
<p>如果你也在手动上传博客，强烈建议你也试试这套方案！</p>
<blockquote>
<p><strong>Next Step:</strong> 下一步准备给服务器配置 HTTPS 证书，让浏览器地址栏加上那个安全的小锁。</p>
</blockquote>

    </div>
</article>

            </main>
        </div>

        <footer class="p-6 text-center text-gray-600 text-xs border-t border-gray-800 flex-shrink-0 bg-geek-bg">
            &copy; 2026 Windows DIY 博客. <span class="hidden sm:inline">Built with Hugo & Love.</span>
        </footer>
    </div>

</body>
</html>